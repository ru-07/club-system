<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
      body { background-color: #f0f2f5; }
      .search-container { max-width: 600px; margin: 20px auto; }
    </style>
  </head>
  <body class="p-4">
    <div class="container bg-white shadow p-4 rounded">
      <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
        <h2 class="text-info fw-bold">ğŸ“Š ç”³è«‹ç‹€æ³å€‹åˆ¥æŸ¥è©¢</h2>
        <button class="btn btn-outline-secondary" onclick="navBack()">å›é¦–é </button>
      </div>

      <div class="search-container">
        <div class="input-group mb-3">
          <input type="text" id="searchInput" class="form-control" placeholder="è«‹è¼¸å…¥æ‚¨çš„å®Œæ•´å­¸è™Ÿ (ä¾‹å¦‚: A112001)">
          <button class="btn btn-primary" onclick="searchStudent()">ç«‹å³æŸ¥è©¢</button>
        </div>
        <p class="text-muted small text-center">æ³¨æ„ï¼šè«‹è¼¸å…¥å®Œæ•´å­¸è™Ÿä»¥ç¢ºä¿è³‡æ–™å®‰å…¨ã€‚</p>
      </div>
      
      <table class="table table-bordered mt-4">
        <thead class="table-info">
          <tr>
            <th>å­¸è™Ÿ</th><th>å§“å</th><th>ç”³è«‹ç¤¾åœ˜</th><th>å¯©æ ¸ç‹€æ…‹</th>
          </tr>
        </thead>
        <tbody id="status-body">
          <tr><td colspan="4" class="text-center text-muted">è«‹åœ¨ä¸Šæ–¹è¼¸å…¥å­¸è™Ÿé€²è¡ŒæŸ¥è©¢</td></tr>
        </tbody>
      </table>
    </div>

    <script>
      let allData = []; // ç”¨ä¾†å­˜å„²å¾å¾Œç«¯æŠ“åˆ°çš„æ‰€æœ‰åŸå§‹è³‡æ–™

      // é é¢åŠ è¼‰å¾Œå…ˆæŠ“å–è³‡æ–™ï¼Œä½†ä¸é¡¯ç¤º
      window.onload = () => {
        google.script.run.withSuccessHandler(data => {
          allData = data;
        }).getAllApplications();
      };

      function searchStudent() {
  const query = document.getElementById('searchInput').value.trim().toUpperCase();
  const tbody = document.getElementById('status-body');
  
  if (!query) {
    alert("è«‹è¼¸å…¥å­¸è™Ÿï¼");
    return;
  }

  // ç¯©é¸ç¬¦åˆå­¸è™Ÿçš„è³‡æ–™
  const results = allData.filter(item => item[1].toString().toUpperCase() === query);

  if (results.length === 0) {
    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger">æ‰¾ä¸åˆ°æ­¤å­¸è™Ÿçš„å ±åè¨˜éŒ„ï¼Œè«‹ç¢ºèªå­¸è™Ÿæ˜¯å¦æ­£ç¢ºã€‚</td></tr>';
  } else {
    let html = '';
    results.forEach(item => {
      // --- ä¿®æ”¹é‡é»ï¼šåˆ¤æ–·ä¸‰ç¨®ç‹€æ…‹çš„é¡è‰² ---
      let badgeClass = 'bg-warning text-dark'; // é è¨­ï¼šå¾…è™•ç† (é»ƒè‰²)
      
      if (item[4] === 'éŒ„å–') {
        badgeClass = 'bg-success';          // éŒ„å–ï¼šç¶ è‰²
      } else if (item[4] === 'æœªéŒ„å–') {
        badgeClass = 'bg-danger';           // æœªéŒ„å–ï¼šç´…è‰²
      }
      // -------------------------------

      // å§“åéš±ç§é®è”½
      let maskedName = item[2].charAt(0) + "*" + (item[2].length > 2 ? item[2].slice(-1) : "");
      
      html += `<tr>
        <td>${item[1]}</td>
        <td>${maskedName}</td>
        <td>${item[3]}</td>
        <td><span class="badge ${badgeClass}">${item[4]}</span></td>
      </tr>`;
    });
    tbody.innerHTML = html;
  }
}
      function navBack() {
        google.script.run.withSuccessHandler(url => window.open(url + '?page=Index','_top')).getScriptUrl();
      }
    </script>
  </body>
</html>
