<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>ç¤¾åœ˜ç•™è¨€æ¿</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body { background-color: #f8f9fa; font-family: "Microsoft JhengHei", sans-serif; }
    .comment-card {
      border-left: 4px solid #0d6efd;
      margin-bottom: 15px;
      background: white;
    }
  </style>
</head>

<body class="p-4">
<div class="container bg-white shadow-sm p-4 rounded">
  <div class="d-flex justify-content-between align-items-center mb-4 border-bottom pb-3">
    <h2 class="text-primary fw-bold" id="club-title">è¼‰å…¥ä¸­...</h2>
    <button class="btn btn-outline-secondary" onclick="history.back()">è¿”å›</button>
  </div>

  <h4 class="mb-3">ğŸ’¬ ç¤¾å“¡ç•™è¨€æ¿</h4>
  <div id="comment-list" class="mb-5 text-muted">è¼‰å…¥ä¸­...</div>

  <div class="card p-4 bg-light border-0">
    <h5 class="mb-3">âœï¸ ç™¼è¡¨ç•™è¨€</h5>
    <input id="nickname" class="form-control mb-2" placeholder="æš±ç¨±ï¼ˆé¸å¡«ï¼‰">
    <textarea id="content" class="form-control mb-3" rows="4" placeholder="ç•™è¨€å…§å®¹"></textarea>
    <button class="btn btn-primary w-100" onclick="submitComment()">é€å‡ºç•™è¨€</button>
  </div>
</div>

<script>
/* ğŸ”§ æ”¹æˆä½ çš„ GAS Web App URL */
const API_URL = "https://script.google.com/macros/s/ä½ çš„ID/exec";

const params = new URLSearchParams(location.search);
const club = params.get("club") || "æœªçŸ¥ç¤¾åœ˜";
document.getElementById("club-title").innerText = club;

function loadComments() {
  fetch(`${API_URL}?action=list&club=${encodeURIComponent(club)}`)
    .then(res => res.json())
    .then(renderComments)
    .catch(() => {
      document.getElementById("comment-list").innerHTML =
        '<div class="alert alert-danger">è¼‰å…¥å¤±æ•—</div>';
    });
}

function renderComments(comments) {
  if (!comments.length) {
    document.getElementById("comment-list").innerHTML =
      '<div class="alert alert-info">ç›®å‰é‚„æ²’æœ‰ç•™è¨€</div>';
    return;
  }

  document.getElementById("comment-list").innerHTML =
    comments.map(c => `
      <div class="card comment-card p-3">
        <div class="d-flex justify-content-between">
          <strong>${c.nickname || "åŒ¿å"}</strong>
          <small>${new Date(c.created_at).toLocaleString("zh-TW")}</small>
        </div>
        <p class="mt-2">${c.content}</p>
      </div>
    `).join("");
}

function submitComment() {
  const payload = {
    action: "add",
    club,
    nickname: document.getElementById("nickname").value || "åŒ¿å",
    content: document.getElementById("content").value
  };

  fetch(API_URL, {
    method: "POST",
    body: JSON.stringify(payload)
  })
  .then(() => {
    document.getElementById("content").value = "";
    loadComments();
  });
}

loadComments();
</script>
</body>
</html>
